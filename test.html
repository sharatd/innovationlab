<!DOCTYPE html>
<html>
<head>
  <title>File Parser</title>
  <meta charset="UTF-8">
  <style>
    #dropzone {
      display:center;
      width: 300px;
      height: 150px;
      border: 4px dashed #00778a;
      margin: auto;
      margin-top:40px;
      margin-bottom:30px;
      padding: 20px;
      font-size: 24px;
      text-align: center;
    }

    #parse-button {
      margin:auto;
      width:250px;
      height:60px;
      margin-bottom:0;
      background-color: #63599e;
    }

    #parse-button:hover {
      margin-top:0px;
      height:60px;
      width:250px;
      background-color: #401f68;

    }

    #button-content{
      color:white;
      width:250px;
      height:60px;
      justify-content:center;
    }

    #filename {
      text-align: center;
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
    }
    #filecontents {
      width:60%;
      justify-content: left;
      margin-top: 20px;
      white-space: pre-wrap;
    }
    #highlight {
        background-color: #b2d8b2;
    }
  </style>
</head>
<body>
  <div id="dropzone">Drag and drop .txt files here</div>
  <button id="parse-button" style="display: block"><h1 id="button-content">Parse</h1></button>
  <div id="filename"></div>
  <p id="filecontents"></p>
  <script>
    import { setList } from "./keywords.js";
    

    const dropzone = document.getElementById('dropzone');
    const parseButton = document.getElementById('parse-button');
    const filenameDiv = document.getElementById('filename');
    const fileContentsPre = document.getElementById('filecontents');
    let droppedFile = null;

    function handleDragOver(event) {
      event.preventDefault();
      dropzone.classList.add('highlight');
    }

    function handleDragLeave(event) {
      dropzone.classList.remove('highlight');
    }

    function handleDrop(event) {
      event.preventDefault();
      dropzone.classList.remove('highlight');
      const files = event.dataTransfer.files;
      if (files.length > 0) {
        droppedFile = files[0];
        filenameDiv.textContent = `Filename: ${droppedFile.name}`;
        parseButton.style.display = 'block';
      }
      //highlightText();
    }
    async function readFileAsText(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.addEventListener('load', () => {
          resolve(reader.result);
        });
        reader.addEventListener('error', () => {
          reject(reader.error);
        });
        reader.readAsText(file);
      });
    }

    parseButton.addEventListener('click', async () => {
      try {
        const fileContents = await readFileAsText(droppedFile);
        fileContentsPre.innerHTML = fileContents;
        let outer = fileContentsPre.outerHTML;
        let highlightedText = highlightText(outer);
        const result = document.querySelector("#result");
        fileContentsPre.outerHTML = highlightedText;
        result.outerHTML = highlightedText;
      } catch (error) {
        console.error(error);
      }
    });

    function highlightText(parobj) {
      //const searchTerm = "verum";
    
      for (list in SetList){
        for (phrase in list){
          searchTerm.append(phrase)
        }
      }
      for (term in searchTerm){
        const regex = new RegExp(term, "gi");
        const highlightedText = parobj.replace(regex, `<span id="highlight">${term}</span>`);
      }
      return highlightedText;
    }

    dropzone.addEventListener('dragover', handleDragOver);
    dropzone.addEventListener('dragleave', handleDragLeave);
    dropzone.addEventListener('drop', handleDrop);
  </script>
</body>
</html>